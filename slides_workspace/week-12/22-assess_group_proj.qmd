---
title: "[Assess] Group Projects"
date: "November 21, 2025"
format: 
  revealjs:
    theme:
      - default
    css: custom.scss
    transition: fade
    slide-number: true
    incremental: false 
    chalkboard: true
    center: true
execute:
  freeze: auto
---

```{r}
#| message: false
#| warning: false
#| include: false

library(sf)
library(tidyverse)
library(mapview)
library(tigris)
library(wesanderson)

brkln_rats <- read_sf("/Users/mc152/Documents/GitHub/ES-202/slides_workspace/week-12/data/brooklyn_rats/rats.shp")

nta <- read_sf("/Users/mc152/Documents/GitHub/ES-202/slides_workspace/week-12/data/nta/nta.shp") |>
  filter(BoroName == "Brooklyn")

nash_holc <- st_read("/Users/mc152/Documents/GitHub/ES-202/slides_workspace/week-12/data/nashville_redlining.json")

nash_ct <- st_read("/Users/mc152/Documents/GitHub/ES-202/slides_workspace/week-12/data/2020_redline_tracts.geojson") |>
  filter(city == "Nashville")

nash_ej_ct <- read_sf("/Users/mc152/Documents/GitHub/ES-202/slides_workspace/week-12/data/nash_ej/nash_ej.shp")
``` 

## Overview
- Centering Activity
- Spatial data in R (mini-lecture)
- Paired Work
- Few Logistics

## Centering Activity {.smaller}
- Write something you're most proud of this semester on the white board
  - Can be non-academic, in fact I suggest it!
- Take a few minutes to read how far we've come!

## Spatial Data in R {.smaller}
- Spatial Operations
- Working with Redlining Data

## Loading Packages + Data {.smaller}
- Load sf, tidyverse, mapview, tigris, and wesanderson packages 
- Dataset from NYC Open Data Portal on [Rat Inspections](https://data.cityofnewyork.us/Health/Rodent-Inspection/p937-wjvj/about_data)
  - [Neighborhood Tabulation Areas](https://data.cityofnewyork.us/Health/Rodent-Inspection/p937-wjvj/about_data) Dataset (NTAs) from NYC Open Data Portal
```{r}
#| warning: false
#| message: false
#| echo: true
#| eval: false

library(sf)
library(tidyverse)
library(tigris)
library(wesanderson)

brkln_rats <- read_sf("data/brooklyn_rats/rats.shp")
nta <- read_sf("data/nta/nta.shp") |>
  filter(BoroName == "Brooklyn")
```


## Quick look at our data {.smaller}
- Here's all of the Rat Activity Sightings since my friends moved into Brooklyn (08/01/2025). 
```{r}
#| warning: false
#| message: false
#| echo: true
#| eval: true

ggplot() +
  geom_sf(data = nta) +
  geom_sf(data = brkln_rats)
```


## Spatial Operations {.smaller}
- Sometimes, we want to select data based on its spatial attributes, rather than numeric/character attributes. 
- Spatial operations are lovely for this reason! 
```{r}
#| warning: false
#| message: false
#| echo: true
#| eval: true

brkln_rats
```

## Spatial Subsetting
  - Perhaps we're interested in selecting only the activity in their neighborhood? 
  - Spatial Subsetting allows you to select 
```{r}
#| warning: false
#| message: false
#| echo: true
#| eval: true

plgw <- nta |>
  filter(NTAName == "Prospect Lefferts Gardens-Wingate")

plgw_rats <- brkln_rats[plgw, ]
```

## My Friends' Rats
```{r}
#| warning: false
#| message: false
#| echo: true
#| eval: true

ggplot() +
  geom_sf(data = plgw) +
  geom_sf(data = plgw_rats)
```

## Working with Redlining Data
- Downloaded spatial data as a GEOJson file for Nashville, TN from the [Mapping Inequality](https://dsl.richmond.edu/panorama/redlining/data/TN-Nashville#cityData) website.
- geoJSON is a text-based spatial files that is easy to use and lightweight. 
- We can also use the `rm()` function to remove objects in our environment we no longer need. 
```{r}
#| warning: false
#| message: false
#| echo: true
#| eval: false

nash_holc <- st_read("data/nashville_redlining.json")

rm(brkln_rats, nta, plgw, plgw_rats)
```

## Nashville HOLC map 
```{r}
#| warning: false
#| message: false
#| echo: true
#| eval: true

ggplot(data = nash_holc) +
  geom_sf(aes(fill = grade)) +
  scale_fill_manual(values = unique(nash_holc$fill))
```

## Crosswalked Census Tracts 
- There's also data available from the mapping inequality project that "crosswalks" the original shapefile to census 2010 and 2020 census tracts. 
- This is useful because you can much more easily join your CT data and visualize both sociodemographics and historic disinvestment. 
```{r}
#| warning: false
#| message: false
#| echo: true
#| eval: false
nash_ct <- st_read("data/2020_redline_tracts.geojson") |>
  filter(city == "Nashville")
```

## HOLC CTs 
```{r}
#| warning: false
#| message: false
#| echo: true
#| eval: true
ggplot(data = nash_ct) +
  geom_sf(aes(fill = grade)) +
  scale_fill_manual(values = unique(nash_ct$fill))
```

## Adding a Continuous EJ Variable
```{r}
#| warning: false
#| message: false
#| echo: true
#| eval: false
nash_ej_ct <- read_sf("data/nash_ej/nash_ej.shp")
```

## Preparing data for Mapping {.smaller}
- I was inspired by this [NYTimes Data piece](https://www.nytimes.com/interactive/2020/08/24/climate/racism-redlining-cities-global-warming.html)
```{r}
#| warning: false
#| message: false
#| echo: true
#| eval: true

# turning off this pesky option
sf_use_s2(FALSE)

# ensure projection is the same
nash_holc <- nash_holc |> st_transform(st_crs(nash_ej_ct))

# select cts in HOLC area
holc_ej <- nash_ej_ct[nash_holc, ]

# filter HOLC regions for D grade
nash_holc_d <- nash_holc |>
  filter(grade == "D")
```

## Map!{.smaller}
```{r}
#| warning: false
#| message: false
#| echo: true
#| eval: true

ggplot() +
  geom_sf(data = holc_ej, aes(fill = lfxppct)) +
  scale_fill_gradientn(
    colors = wes_palette("Zissou1", 100, type = "continuous"),
    name = "% Low Life Expectancy"
  ) +
  geom_sf(
    data = nash_holc_d,
    color = "black",
    fill = NA,
    linewidth = 0.8
  ) +
  theme_void()
```

## Paired Work 

## Few Logistics
- HEET joining us on Tuesday! 
  - One reading and one video to watch (pay attention to assigned chapters)
  - Class will be **hybrid**, use link on Week 13 to join!
- Reyna + Clara to prepare questions, Simmie to send thank you email. 
- Office Hours Wednesday, October 26, 2025 will be **virtual**